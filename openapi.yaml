openapi: 3.0.3
info:
  title: Ecommerce Full Stack API
  version: '1.0.0'
  description: Representative OpenAPI spec generated from route inspection. Use DTOs in `src/dtos` as the source of truth.
servers:
  - url: http://localhost:3000
paths:
  /health:
    get:
      summary: Health check
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
  /api/v1/me:
    get:
      summary: Get current session
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Session object
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
  /api/v1/users:
    post:
      summary: Create user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUser'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
    get:
      summary: List users
      parameters:
        - in: query
          name: page
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
  /api/v1/products:
    get:
      summary: List products
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
    post:
      summary: Create product (seller)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProduct'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
  /api/v1/products/{id}:
    get:
      summary: Get product by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
    put:
      summary: Update product
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProduct'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
    delete:
      summary: Delete product
      responses:
        '204':
          description: Deleted
  /api/v1/carts:
    post:
      summary: Create cart
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCart'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
  /api/v1/carts/{id}:
    get:
      summary: Get cart
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
  /api/v1/carts/{id}/items:
    post:
      summary: Add cart item
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddCartItem'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
  /api/v1/orders:
    post:
      summary: Create order
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrder'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
    get:
      summary: List orders
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponse'
  /api/v1/payments:
    post:
      summary: Create payment
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePayment'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
  /api/v1/payments/webhook:
    post:
      summary: Payment gateway webhook (public)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookPayment'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
  /api/auth/sign-in/email:
    post:
      summary: Sign in with email (Better Auth email strategy)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthSignIn'
      responses:
        '200':
          description: Signed in (returns token or session info)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
  /api/auth/sign-up/email:
    post:
      summary: Sign up with email (Better Auth email strategy)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUser'
      responses:
        '201':
          description: Created (Better Auth may also return session info)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
  /api/v1/coupons/validate:
    post:
      summary: Validate/apply coupon
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplyCoupon'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    cookieAuth:
      type: apiKey
      in: cookie
      name: session
  schemas:
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: ok
    StandardResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        data:
          type: object
        message:
          type: string
        correlationId:
          type: string
    PaginatedResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        data:
          type: array
          items: {}
        meta:
          type: object
          properties:
            total: { type: integer }
            page: { type: integer }
            limit: { type: integer }
    CreateUser:
      type: object
      required: [email, password, name]
      properties:
        email: { type: string, format: email }
        password: { type: string }
        name: { type: string }
        role:
          type: string
          enum: [ADMIN, SELLER, CUSTOMER]
    User:
      type: object
      properties:
        id: { type: string }
        email: { type: string, format: email }
        role: { type: string }
        name: { type: string }
        phone: { type: string, nullable: true }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        emailVerified: { type: boolean }
        image: { type: string, nullable: true }
    Product:
      type: object
      properties:
        id: { type: string }
        vendorId: { type: string }
        title: { type: string }
        slug: { type: string }
        description: { type: string, nullable: true }
        priceCents: { type: integer }
        originalPriceCents: { type: integer, nullable: true }
        stock: { type: integer, nullable: true }
        shippingFeeCents: { type: integer, nullable: true }
        deliveryTime: { type: string, nullable: true }
        image: { type: string, format: uri, nullable: true }
        images:
          type: array
          items: { type: string, format: uri }
        categorySlugs:
          type: array
          items: { type: string }
        status:
          type: string
          enum: [ACTIVE, INACTIVE, DRAFT, ARCHIVED]
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    AuthSignIn:
      type: object
      required: [email, password]
      properties:
        email: { type: string, format: email }
        password: { type: string }
    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          example: error
        message:
          type: string
        errors:
          type: object
        correlationId:
          type: string
    CreateProduct:
      type: object
      required: [vendorId, title, priceCents]
      properties:
        vendorId: { type: string }
        title: { type: string }
        slug: { type: string }
        description: { type: string }
        priceCents: { type: integer }
        originalPriceCents: { type: integer }
        stock: { type: integer }
        shippingFeeCents: { type: integer }
        deliveryTime: { type: string }
        image: { type: string, format: uri }
        images:
          type: array
          items: { type: string, format: uri }
        categorySlugs:
          type: array
          items: { type: string }
        status:
          type: string
          enum: [ACTIVE, INACTIVE, DRAFT, ARCHIVED]
    UpdateProduct:
      allOf:
        - $ref: '#/components/schemas/CreateProduct'
        - type: object
          nullable: true
    CreateCart:
      type: object
      properties:
        userId: { type: string }
        sessionId: { type: string }
    AddCartItem:
      type: object
      required: [productId, title, unitPriceCents, quantity]
      properties:
        productId: { type: string }
        title: { type: string }
        unitPriceCents: { type: integer }
        quantity: { type: integer }
        image: { type: string, format: uri }
        variantSku: { type: string }
    CreateOrder:
      type: object
      required: [items, totalCents]
      properties:
        customerId: { type: string }
        items:
          type: array
          items:
            type: object
            required: [productId, vendorId, title, unitPriceCents, quantity]
            properties:
              productId: { type: string }
              vendorId: { type: string }
              title: { type: string }
              unitPriceCents: { type: integer }
              quantity: { type: integer }
              image: { type: string, format: uri }
              variantSku: { type: string }
        totalCents: { type: integer }
        shippingAddress: { type: object }
        couponCode: { type: string }
    CreatePayment:
      type: object
      required: [orderId, method, amountCents]
      properties:
        orderId: { type: string }
        method:
          type: string
          enum: [CARD, WALLET, COD, BANK_TRANSFER]
        amountCents: { type: integer }
        currency: { type: string }
        gateway: { type: string }
        transactionRef: { type: string }
    WebhookPayment:
      type: object
      required: [orderId, status]
      properties:
        orderId: { type: string }
        transactionRef: { type: string }
        status:
          type: string
          enum: [PENDING, AUTHORIZED, PAID, FAILED, REFUNDED]
        gateway: { type: string }
        amountCents: { type: integer }
    ApplyCoupon:
      type: object
      required: [code, totalCents]
      properties:
        code: { type: string }
        totalCents: { type: integer }
        categorySlugs:
          type: array
          items: { type: string }
